<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur de Pr√™t Pro - Graphique & Tableau</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; padding: 20px; color: #1a1a1a; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 30px; }
        .grid-input { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px; color: #444; }
        
        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; align-items: center; }
        @media (max-width: 768px) { .main-content { grid-template-columns: 1fr; } }

        .stats { background: #f8fafc; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; }
        .stat-item { margin-bottom: 15px; border-bottom: 1px solid #e2e8f0; padding-bottom: 10px; }
        .stat-item:last-child { border: none; }
        .stat-label { font-size: 13px; color: #64748b; text-transform: uppercase; }
        .stat-value { font-size: 22px; font-weight: bold; color: #0f172a; display: block; }

        .table-container { margin-top: 40px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        th { background: #334155; color: white; padding: 12px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #e2e8f0; }
        tr:nth-child(even) { background: #f8fafc; }

        canvas { max-width: 100%; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>üìä Simulateur de Cr√©dit Avanc√©</h1>
        <p>Calculez l'impact r√©el de vos emprunts</p>
    </div>

    <div class="grid-input">
        <div>
            <label>Capital emprunt√© (‚Ç¨)</label>
            <input type="number" id="capital" value="5000" oninput="runSimulation()">
        </div>
        <div>
            <label>Taux annuel (%)</label>
            <input type="number" id="rate" value="4.5" step="0.1" oninput="runSimulation()">
        </div>
        <div>
            <label>Dur√©e (mois)</label>
            <input type="number" id="duration" value="24" oninput="runSimulation()">
        </div>
    </div>

    <div class="main-content">
        <div class="stats">
            <div class="stat-item">
                <span class="stat-label">Mensualit√©</span>
                <span class="stat-value" id="res-monthly">--</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Co√ªt des int√©r√™ts</span>
                <span class="stat-value" id="res-interests" style="color: #ef4444;">--</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Total rembours√©</span>
                <span class="stat-value" id="res-total">--</span>
            </div>
        </div>
        <div>
            <canvas id="myChart"></canvas>
        </div>
    </div>

    <div class="table-container">
        <h3>üìÖ Tableau d'amortissement</h3>
        <table id="amortization-table">
            <thead>
                <tr>
                    <th>Mois</th>
                    <th>Mensualit√©</th>
                    <th>Int√©r√™ts</th>
                    <th>Capital rembours√©</th>
                    <th>Restant d√ª</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
let myChart;

function runSimulation() {
    const P = parseFloat(document.getElementById('capital').value);
    const annualRate = parseFloat(document.getElementById('rate').value) / 100;
    const n = parseInt(document.getElementById('duration').value);

    if (!P || P <= 0 || n <= 0) return;

    const r = annualRate / 12;
    const monthly = (r === 0) ? P / n : (P * r) / (1 - Math.pow(1 + r, -n));
    const totalRepaid = monthly * n;
    const totalInterest = totalRepaid - P;

    // Mise √† jour des chiffres
    document.getElementById('res-monthly').innerText = monthly.toFixed(2) + " ‚Ç¨";
    document.getElementById('res-interests').innerText = totalInterest.toFixed(2) + " ‚Ç¨";
    document.getElementById('res-total').innerText = totalRepaid.toFixed(2) + " ‚Ç¨";

    updateChart(P, totalInterest);
    updateTable(P, r, monthly, n);
}

function updateChart(capital, interests) {
    const ctx = document.getElementById('myChart').getContext('2d');
    
    if (myChart) myChart.destroy();

    myChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Capital (Prix de base)', 'Int√©r√™ts (Co√ªt du pr√™t)'],
            datasets: [{
                data: [capital, interests],
                backgroundColor: ['#3b82f6', '#ef4444'],
                hoverOffset: 4
            }]
        },
        options: {
            plugins: {
                legend: { position: 'bottom' }
            }
        }
    });
}

function updateTable(P, r, monthly, n) {
    const tbody = document.querySelector('#amortization-table tbody');
    tbody.innerHTML = "";
    
    let remaining = P;
    
    for (let i = 1; i <= n; i++) {
        let interestPart = remaining * r;
        let principalPart = monthly - interestPart;
        remaining -= principalPart;

        // S√©curit√© pour √©viter les petits chiffres n√©gatifs dus √† l'arrondi JS
        if (remaining < 0) remaining = 0;

        const row = `<tr>
            <td>${i}</td>
            <td>${monthly.toFixed(2)} ‚Ç¨</td>
            <td>${interestPart.toFixed(2)} ‚Ç¨</td>
            <td>${principalPart.toFixed(2)} ‚Ç¨</td>
            <td>${remaining.toFixed(2)} ‚Ç¨</td>
        </tr>`;
        tbody.innerHTML += row;
    }
}

// Initialisation
runSimulation();
</script>

</body>
</html>
